<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Game Complete â€” Leaderboard</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<style>
  body {
    background: linear-gradient(120deg,#06081A,#6D28D9 25%,#0F172A 50%,#06B6D4 75%);
    background-size: 300% 300%;
    animation: gradientMove 18s ease infinite;
    font-family: 'Poppins', sans-serif;
    overflow-x: hidden;
  }
  @keyframes gradientMove {
    0%{background-position:0% 50%}
    50%{background-position:100% 50%}
    100%{background-position:0% 50%}
  }
  .glass {
    background: rgba(255, 255, 255, 0.06);
    backdrop-filter: blur(12px);
    border: 1px solid rgba(255,255,255,0.08);
  }
  .rank-glow-1 { box-shadow: 0 0 25px rgba(251,191,36,0.9); }
  .rank-glow-2 { box-shadow: 0 0 25px rgba(236,72,153,0.9); }
  .rank-glow-3 { box-shadow: 0 0 25px rgba(6,182,212,0.9); }
  .animate-fade-scale {
    animation: fadeScale 0.8s ease forwards;
  }
  @keyframes fadeScale {
    from { opacity: 0; transform: scale(0.8) translateY(20px); }
    to { opacity: 1; transform: scale(1) translateY(0); }
  }
  .badge {
    padding: 2px 8px;
    border-radius: 9999px;
    font-size: 0.75rem;
    font-weight: 500;
    display: inline-block;
  }
  .podium {
    display: flex;
    justify-content: center;
    align-items: flex-end;
    gap: 1rem;
  }
  .podium > div {
    text-align: center;
    padding: 1rem;
    border-radius: 1rem;
  }
  .podium img {
    border-radius: 50%;
    border: 3px solid white;
  }
  .achievement-card {
    transition: transform 0.3s ease;
  }
  .achievement-card:hover {
    transform: scale(1.05);
  }
</style>
</head>
<body class="text-white">

<!-- Title -->
<div class="text-center mt-8 px-4">
  <h1 class="text-4xl md:text-6xl font-extrabold bg-clip-text text-transparent bg-gradient-to-r from-amber-400 via-pink-500 to-cyan-400 animate-fade-scale">
    ğŸ† Game Complete
  </h1>
  <p class="text-white/70 mt-2">Final results are in! Hereâ€™s how everyone did.</p>
</div>

<!-- Podium for Top 3 -->
<div class="podium mt-10 px-4">
  <div id="second" class="glass rank-glow-2">
    <img class="w-16 h-16" src="" alt="">
    <h3 class="mt-2 font-bold">ğŸ¥ˆ</h3>
    <div class="text-lg font-extrabold score">0</div>
  </div>
  <div id="first" class="glass rank-glow-1 scale-110">
    <img class="w-20 h-20" src="" alt="">
    <h3 class="mt-2 font-bold">ğŸ‘‘</h3>
    <div class="text-lg font-extrabold score">0</div>
  </div>
  <div id="third" class="glass rank-glow-3">
    <img class="w-16 h-16" src="" alt="">
    <h3 class="mt-2 font-bold">ğŸ¥‰</h3>
    <div class="text-lg font-extrabold score">0</div>
  </div>
</div>

<!-- Leaderboard List -->
<div id="leaderboard" class="max-w-4xl mx-auto mt-10 grid grid-cols-1 gap-4 px-4"></div>

<!-- Achievements -->
<div class="max-w-4xl mx-auto mt-12 px-4">
  <h2 class="text-2xl font-bold mb-4">ğŸ… Achievements</h2>
  <div id="achievements" class="grid grid-cols-2 sm:grid-cols-4 gap-4"></div>
</div>

<!-- Buttons -->
<div class="flex flex-wrap justify-center gap-4 mt-8 px-4">
  <button onclick="playAgain()" class="px-6 py-3 rounded-xl glass hover:scale-105 hover:bg-gradient-to-r hover:from-emerald-400 hover:to-amber-400 transition-all duration-300">ğŸ”„ Play Again</button>
  <button onclick="backToLobby()" class="px-6 py-3 rounded-xl glass hover:scale-105 hover:bg-gradient-to-r hover:from-amber-400 hover:to-pink-500 transition-all duration-300">ğŸ  Back to Lobby</button>
  <button onclick="shareResults()" class="px-6 py-3 rounded-xl glass hover:scale-105 hover:bg-gradient-to-r hover:from-cyan-400 hover:to-emerald-400 transition-all duration-300">ğŸ“¤ Share</button>
</div>

<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

const supabaseUrl = 'https://YOUR_PROJECT_ID.supabase.co';
const supabaseKey = 'YOUR_ANON_KEY';
const supabase = createClient(supabaseUrl, supabaseKey);

const leaderboardDiv = document.getElementById("leaderboard");

// Fetch scores from Supabase
async function fetchLeaderboard() {
  const { data, error } = await supabase
    .from('scores')
    .select('*')
    .order('score', { ascending: false });

  if(error){ console.error(error); return; }
  
  const topPlayers = data.slice(0,3);
  const restPlayers = data.slice(3);

  // Fill podium
  ["first","second","third"].forEach((id,i)=>{
    const player = topPlayers[i];
    if(player){
      const div = document.getElementById(id);
      div.querySelector("img").src = `https://ui-avatars.com/api/?name=${player.username}&background=random`;
      div.querySelector(".score").textContent = player.score;
      div.querySelector("h3").textContent = i===0?'ğŸ‘‘':'ğŸ¥ˆğŸ¥‰'.charAt(i-1);
    }
  });

  // Fill leaderboard
  leaderboardDiv.innerHTML = '';
  restPlayers.forEach((player,i)=>{
    const badge = getBadge(player,i+3);
    const el = document.createElement("div");
    el.className = `glass rounded-xl p-4 flex items-center justify-between animate-fade-scale`;
    el.style.animationDelay = `${i * 0.1}s`;
    el.innerHTML = `
      <div class="flex items-center gap-4">
        <img src="https://ui-avatars.com/api/?name=${player.username}&background=random" alt="${player.username}" class="w-12 h-12 rounded-full border-2 border-white/30">
        <div>
          <div class="font-bold text-lg flex items-center gap-2">${i+4}. ${player.username}</div>
          <div class="badge ${badge.color}">${badge.text}</div>
        </div>
      </div>
      <div class="text-xl font-extrabold" id="score-${i}">0</div>
    `;
    leaderboardDiv.appendChild(el);

    // Animate score
    let start = 0;
    const duration = 1000;
    const startTime = performance.now();
    function animateScore(time) {
      const progress = Math.min((time - startTime)/duration, 1);
      const eased = 1 - Math.pow(1 - progress,3);
      document.getElementById(`score-${i}`).textContent = Math.floor(eased*player.score);
      if(progress<1) requestAnimationFrame(animateScore);
    }
    requestAnimationFrame(animateScore);
  });
}

// Badge logic
function getBadge(player, index) {
  if(index===0) return { text: "ğŸ¥‡ MVP", color: "bg-amber-400 text-indigo-900" };
  if(player.score>=800) return { text: "ğŸ¯ Sharp Shooter", color:"bg-pink-500 text-white"};
  return { text:"ğŸ›¡ï¸ Resilient", color:"bg-emerald-400 text-indigo-900"};
}

// Achievements
const achievementsDiv = document.getElementById("achievements");
const achievementList = [
  { icon: "ğŸ¯", text: "Perfect Accuracy" },
  { icon: "âš¡", text: "Fastest Answer" },
  { icon: "ğŸ“ˆ", text: "Comeback Kid" },
  { icon: "ğŸ†", text: "Quiz Legend" }
];
achievementList.forEach(a=>{
  const card = document.createElement("div");
  card.className = "glass p-4 rounded-xl text-center achievement-card";
  card.innerHTML = `<div class="text-3xl">${a.icon}</div><div class="mt-2 text-sm">${a.text}</div>`;
  achievementsDiv.appendChild(card);
});

// Buttons
function playAgain(){ alert("Play Again clicked."); }
function backToLobby(){ alert("Back to Lobby clicked."); }
function shareResults(){
  const text = `I just played QuizVerse! Check out the leaderboard!`;
  if(navigator.share) navigator.share({ title:'QuizVerse', text });
  else window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}`, '_blank');
}

// Load data & realtime updates
fetchLeaderboard();
supabase
  .from('scores')
  .on('*', payload => {
    console.log('Realtime update:', payload);
    fetchLeaderboard();
    confetti({ particleCount: 100, spread: 60, origin:{ y:0.6 }});
  })
  .subscribe();
</script>
</body>
</html>